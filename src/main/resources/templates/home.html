<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Learning - Học Online</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"></div>
    <link rel="icon" type="image/x-icon" href="https://res.cloudinary.com/dsuav027e/image/upload/v1740393796/favicon_llcueu.ico">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</head>
<body >
<div th:insert="~{fragments/header :: header}"></div>


<main>
    <section class="hero-section py-5">
        <div class="container">
            <div class="row align-items-center bg-purple text-white rounded shadow-lg p-5 " style="background-color: #2d50ff;">
                <!-- Nội dung chữ -->
                <div class="col-12 col-md-8">
                    <div class="text-box">
                        <h1 class="fw-bold text-uppercase" style="font-size: 70px;">Phát triển & nâng cao <br> kỹ năng của bạn</h1>
                        <p class="opacity-75" style="font-size: 30px;">Khám phá các chiến lược nâng cao để tối ưu hóa quá trình học tập, nâng cao kỹ năng và đạt được thành công nhanh chóng trong sự nghiệp.</p>
                        <button class="btn btn-light btn-lg text-purple fw-bold" style="color: #6f42c1;">Khám phá</button>
                    </div>
                </div>

                <!-- Hình ảnh -->
                <div class="col-12 col-md-4 text-center">
                    <img src="/img/studentVR.png" alt="Học viên VR" class="img-fluid rounded">
                </div>
            </div>
        </div>
    </section>


    <!-- Thanh tìm kiếm -->`
    <p class="search-text col-md-12" style="display: flex; justify-content: center; font-size: 40px;">Tìm kiếm đề thi mong muốn của bạn</p>
    <div class="card shadow-lg p-4 bg-white rounded mx-auto" style="max-width: 900px; margin-bottom: 50px;">
        <h4 class="text-center text-success mb-3">Tìm kiếm đề thi</h4>
        <form action="/search-by-filter" method="get" class="d-flex flex-wrap gap-2 justify-content-between">
            <select name="grade" class="form-select flex-grow-1">
                <option value="">Chọn khối lớp</option>
                <option value="10">Lớp 10</option>
                <option value="11">Lớp 11</option>
                <option value="12">Lớp 12</option>
            </select>

            <select name="subject" class="form-select flex-grow-1">
                <option value="">Chọn môn học</option>
                <option value="Toán">Toán</option>
                <option value="Vật Lý">Vật lý</option>
            </select>

            <select name="examType" class="form-select flex-grow-1">
                <option value="">Chọn loại đề</option>
                <option value="Đề kiểm tra">Đề kiểm tra</option>
                <option value="Đề luyện tập">Đề luyện tập</option>
                <option value="Đề THPT QUỐC GIA">Đề THPT QUỐC GIA</option>
            </select>

            <select name="city" id="city" class="form-select flex-grow-1">
                <option value="">Chọn thành phố</option>
            </select>

            <button type="submit" class="btn btn-primary w-100 mt-2">Tìm kiếm</button>
        </form>
    </div>


    <script>
        const cities = ["Hà Nội", "Hồ Chí Minh", "Đà Nẵng", "Hải Phòng", "Cần Thơ", "An Giang", "Bà Rịa - Vũng Tàu",
            "Bắc Giang", "Bắc Kạn", "Bạc Liêu", "Bắc Ninh", "Bến Tre", "Bình Định", "Bình Dương", "Bình Phước", "Bình Thuận", "Cà Mau",
            "Cao Bằng", "Đắk Lắk", "Đắk Nông", "Điện Biên", "Đồng Nai", "Đồng Tháp", "Gia Lai", "Hà Giang", "Hà Nam", "Hà Tĩnh", "Hải Dương",
            "Hậu Giang", "Hòa Bình", "Hưng Yên", "Khánh Hòa", "Kiên Giang", "Kon Tum", "Lai Châu", "Lâm Đồng", "Lạng Sơn", "Lào Cai", "Long An",
            "Nam Định", "Nghệ An", "Ninh Bình", "Ninh Thuận", "Phú Thọ", "Phú Yên", "Quảng Bình", "Quảng Nam", "Quảng Ngãi", "Quảng Ninh", "Quảng Trị",
            "Sóc Trăng", "Sơn La", "Tây Ninh", "Thái Bình", "Thái Nguyên", "Thanh Hóa", "Thừa Thiên Huế", "Tiền Giang", "Trà Vinh", "Tuyên Quang", "Vĩnh Long",
            "Vĩnh Phúc", "Yên Bái"];
        const citySelect = document.getElementById('city');
        cities.forEach(city => {
            const option = document.createElement('option');
            option.value = city; // Giữ nguyên giá trị gốc
            option.textContent = city;
            citySelect.appendChild(option);
        });
    </script>

    <div class="container-fluid"> <!-- Thay container thành container-fluid -->
        <div class="popular-exams row gx-md-5 px-md-5">
            <!-- Cột đề thi -->
            <div class="exam-grid col-12 col-md-9 pe-md-3" style="min-width: 700px;"> <!-- Tăng width -->
                <div class="row g-4">
                    <div class="col-12 col-md-6 mb-4" th:each="exam : ${exams}">
                        <div class="exam-card p-3 shadow-sm rounded border">
                            <strong th:text="${exam.examName}" class="text-primary d-block mb-2"></strong>
                            <p class="mb-2"><i class="bi bi-people-fill text-info"></i> <b>Lớp: </b> <span th:text="${exam.grade}"></span></p>
                            <p class="mb-2"><i class="bi bi-journal-text text-success"></i> <b>Môn học:</b> <span th:text="${exam.subject}"></span></p>
                            <p class="mb-2"><i class="bi bi-ui-checks-grid text-warning"></i> <b>Dạng đề: </b><span th:text="${exam.examType}"></span></p>
                            <p class="mb-2"><i class="bi bi-geo-alt-fill text-danger"></i> <b>Tỉnh - Thành Phố: </b><span th:text="${exam.city}"></span></p>
                            <p class="mb-2"><i class="bi bi-calendar-event text-secondary"></i> <b>Ngày đăng:</b> <span th:text="${exam.date}"></span></p>
                            <p class="mb-3"><i class="bi bi-list-ol text-primary"></i> <b>Câu hỏi:</b> <span th:text="${exam.questionCount}"></span></p>

                            <div class="button-container d-flex justify-content-between align-items-center">
                                <div th:if="${exam.examID}" class="d-flex gap-2 w-100">
                                    <form th:action="@{/exams/{id}/detail(id=${exam.examID})}" method="get" class="w-50">
                                        <button class="btn btn-sm btn-primary w-90">
                                            <i class="bi bi-eye-fill"></i> Xem chi tiết
                                        </button>
                                    </form>
                                    <form th:action="@{/exams/{id}/do(id=${exam.examID})}" method="get" class="w-50">
                                        <button class="btn btn-sm btn-danger w-90">
                                            <i class="bi bi-play-fill"></i> Bắt đầu làm bài
                                        </button>
                                    </form>
                                </div>
                                <button class="btn btn-outline-danger btn-sm likeButton"
                                        th:attr="data-exam-id=${exam.examID}, data-liked=${isLiked}">
                                    <i class="fa-regular fa-heart"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bảng xếp hạng -->
            <div class="rank-panel col-12 col-md-3 mt-4 mt-md-0 ps-md-3 " style=" min-width: 300px;"> <!-- Giảm width -->
                <h4 class="text-center mb-4">BXH học sinh có điểm số cao nhất</h4>
                <ul class="list-group">
                    <li class="list-group-item d-flex align-items-center mb-3 rounded">
                        <div class="avatar bg-primary text-white rounded-circle d-flex justify-content-center align-items-center me-2" style="width: 32px; height: 32px">A</div>
                        Username1 - Điểm
                    </li>
                    <li class="list-group-item d-flex align-items-center mb-3 rounded">
                        <div class="avatar bg-secondary text-white rounded-circle d-flex justify-content-center align-items-center me-2" style="width: 32px; height: 32px">B</div>
                        Username2 - Điểm
                    </li>
                    <li class="list-group-item d-flex align-items-center mb-3 rounded">
                        <div class="avatar bg-success text-white rounded-circle d-flex justify-content-center align-items-center me-2" style="width: 32px; height: 32px">C</div>
                        Username3 - Điểm
                    </li>
                </ul>

                <h4 class="text-center mt-5 mb-4">BXH đóng góp</h4>
                <ul class="list-group">
                    <li class="list-group-item d-flex align-items-center mb-3 rounded">
                        <div class="avatar bg-warning text-white rounded-circle d-flex justify-content-center align-items-center me-2" style="width: 32px; height: 32px">A</div>
                        Username1 - Điểm đóng góp
                    </li>
                    <li class="list-group-item d-flex align-items-center mb-3 rounded">
                        <div class="avatar bg-danger text-white rounded-circle d-flex justify-content-center align-items-center me-2" style="width: 32px; height: 32px">B</div>
                        Username2 - Điểm đóng góp
                    </li>
                </ul>
            </div>
        </div>
    </div>

</main>
<script>
    document.querySelectorAll(".likeButton").forEach(button => {
        let examId = button.getAttribute("data-exam-id");
        let icon = button.querySelector("i");

        // Kiểm tra trạng thái like khi trang tải
        fetch(`/exams/${examId}/isLiked`) // Dùng backtick ``
            .then(response => response.json())
            .then(data => {
                if (data.liked) {
                    button.classList.add("liked");
                    icon.classList.replace("fa-regular", "fa-solid");
                }
            })
            .catch(error => console.error("Lỗi kiểm tra like:", error));

        // Toggle Like/Unlike
        button.addEventListener("click", function() {
            let isLiked = button.classList.contains("liked");

            fetch(`/exams/${examId}/like`, { // Dùng backtick ``
                method: isLiked ? "DELETE" : "POST"
            })
                .then(response => response.json())
                .then(data => {
                    if (data.message === "Bạn cần đăng nhập để like.") {
                        if (confirm("Bạn cần đăng nhập để like. Chuyển đến trang đăng nhập?")) {
                            window.location.href = "/login";
                        }
                        return;
                    }

                    // Chỉ thay đổi giao diện, không hiện thông báo
                    button.classList.toggle("liked");
                    icon.classList.toggle("fa-solid");
                    icon.classList.toggle("fa-regular");
                })
                .catch(error => console.error("Lỗi:", error));
        });
    });
</script>

<div th:insert="~{fragments/footer :: footer}"></div>

</body>
</html>