<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>E-Learning - H·ªçc Online</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
  <style>
    body {
      font-family: Arial, sans-serif;
      color: black;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin-top: 20px;
    }

    .custom-file-input {
      width: auto; /* L√†m input file nh·ªè l·∫°i */
      max-width: 200px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông */
      font-size: 14px; /* Gi·∫£m c·ª° ch·ªØ */
      padding: 5px; /* Thu g·ªçn kho·∫£ng c√°ch b√™n trong */
    }

    .posts .post {
      background: #e8e8e8;
      padding: 10px;
      border-radius: 5px;
      margin-bottom: 10px;
    }
    .dropdown-item {
      padding: 0.5rem 1rem;
      color: black;
      transition: all 0.2s ease;
    }

    .dropdown-item:hover {
      background-color: #f8f9fa;
      color: #0070f3;
    }

    .post-images img {
      width: 100%;
      border-radius: 5px;
    }
    .post-images .image-container {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }
    .post-images .image-container img {
      width: calc(50% - 5px);
    }
    .post-images .more-images {
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    .hidden-images {
      display: none;
      flex-wrap: wrap;
      gap: 10px;
    }
    .hidden-images img {
      width: calc(50% - 5px);
    }
    .collapse-images {
      display: none;
      text-align: center;
      margin-top: 10px;
      padding: 5px;
      background-color: #f0f0f0;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      color: #333;
    }

    .collapse-images:hover {
      background-color: #e0e0e0;
    }

    textarea {
      border: 2px solid #000;
      width: 100%;
      padding: 10px;
      resize: none;
    }
    .red-button {
      background-color: red;
      color: white;
      border: none;
      padding: 10px 15px;
      cursor: pointer;
    }
    .red-button:hover {
      background-color: red; /* M√†u ƒë·ªè hover */
      color: white; /* ƒê·∫£m b·∫£o m√†u ch·ªØ kh√¥ng tr√πng n·ªÅn */
    }

    .toggle-comments{
      cursor: pointer;
    }

    .comment-image {
      max-width: 100px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông t·ªëi ƒëa */
      max-height: 100px; /* Gi·ªõi h·∫°n chi·ªÅu cao t·ªëi ƒëa */
      cursor: pointer; /* Hi·ªÉn th·ªã con tr·ªè khi di chu·ªôt qua ·∫£nh */
      border-radius: 5px; /* Bo g√≥c ·∫£nh */
      margin: 5px 0; /* Th√™m kho·∫£ng c√°ch gi·ªØa c√°c ·∫£nh */
    }

    .hidden-comment {
      display: none;
    }

    .comment-images {
      display: flex;
      gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa c√°c ·∫£nh */
      flex-wrap: wrap; /* Xu·ªëng d√≤ng n·∫øu c√≥ nhi·ªÅu ·∫£nh */
    }

    .show-more-comments {
      text-align: center;
      margin-top: 10px;
      padding: 5px;
      background-color: #f0f0f0;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      color: #333;
    }

    .show-more-comments:hover {
      background-color: #e0e0e0;
    }

    .rounded-circle {
      object-fit: cover;
    }

    .hidden {
      display: none;
    }

    #lightbox {
      display: none; /* ·∫®n lightbox ban ƒë·∫ßu */
    }

    #lightbox.show {
      display: flex; /* Hi·ªÉn th·ªã lightbox khi c√≥ class 'show' */
    }

    #lightbox-close {
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 24px;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
<div th:insert="fragments/header :: header"></div>
<div class="container mt-4">
  <div class="row">
    <aside class="col-md-3">
      <div class="card">
        <div class="card-header">
          <h2>Ch·ªß ƒë·ªÅ m√¥n h·ªçc</h2>
        </div>
        <ul class="list-group list-group-flush">
          <li><a href="/forum">T·∫•t c·∫£</a></li>
          <li><a href="/forum?subject=toan">To√°n h·ªçc</a></li>
          <li><a href="/forum?subject=van">Ng·ªØ vƒÉn</a></li>
          <li><a href="/forum?subject=su">L·ªãch s·ª≠</a></li>
          <li><a href="/forum?subject=sinh">Sinh h·ªçc</a></li>
          <li><a href="/forum?subject=dia">ƒê·ªãa l√Ω</a></li>
          <li><a href="/forum?subject=ly">V·∫≠t l√Ω</a></li>
          <li><a href="/forum?subject=hoa">H√≥a h·ªçc</a></li>
          <li><a href="/forum?subject=ngoaingu">Ngo·∫°i ng·ªØ</a></li>
          <li><a href="/forum?subject=khac">Kh√°c</a></li>
        </ul>
      </div>
    </aside>

    <main class="col-md-6">
      <div class="card" th:if="${username}">
        <form action="/forum/create" method="post" enctype="multipart/form-data" class="mb-2">
          <input type="hidden" name="username" th:value="${username}">
          <div class="row mt-3 mb-2">
            <div class="col-md-6">
              <select class="form-select" name="subject" required>
                <option value="" selected disabled>Ch·ªçn m√¥n h·ªçc</option>
                <option value="toan">To√°n h·ªçc</option>
                <option value="van">Ng·ªØ vƒÉn</option>
                <option value="su">L·ªãch s·ª≠</option>
                <option value="sinh">Sinh h·ªçc</option>
                <option value="dia">ƒê·ªãa l√Ω</option>
                <option value="ly">V·∫≠t l√Ω</option>
                <option value="hoa">H√≥a h·ªçc</option>
                <option value="ngoaingu">Ngo·∫°i ng·ªØ</option>
                <option value="khac">Kh√°c</option>
              </select>
            </div>
            <div class="col-md-6">
              <select class="form-select" name="grade" required>
                <option value="" selected disabled>Ch·ªçn l·ªõp</option>
                <option value="10">L·ªõp 10</option>
                <option value="11">L·ªõp 11</option>
                <option value="12">L·ªõp 12</option>
              </select>
            </div>
          </div>
          <input type="hidden" name="subject" th:value="${selectedSubject}">
          <textarea name="content" class="form-control" placeholder="H·ªèi g√¨ ƒë√≥ ..." required></textarea><br>
          <div class="d-flex justify-content-between align-items-center">
            <input type="file" name="images" multiple class="custom-file-input"><br>
            <button type="submit" class="red-button btn">ƒêƒÉng b√†i</button>
          </div>
        </form>
      </div>
      <p style="color:white" th:if="${username == null}">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng b√†i.</p>
      <h3>üìö Ch·ªß ƒë·ªÅ: <span th:text="${selectedSubject}"></span></h3>
      <div class="class-filter" th:if="${selectedSubject}">
        <a th:href="@{/forum(subject=${#strings.trim(selectedSubject)})}" class="btn btn-primary">Chung</a>
        <a th:href="@{/forum(subject=${#strings.trim(selectedSubject)}, grade='10')}" class="btn btn-secondary">L·ªõp 10</a>
        <a th:href="@{/forum(subject=${#strings.trim(selectedSubject)}, grade='11')}" class="btn btn-secondary">L·ªõp 11</a>
        <a th:href="@{/forum(subject=${#strings.trim(selectedSubject)}, grade='12')}" class="btn btn-secondary">L·ªõp 12</a>
      </div>
      <div class="posts">
        <div class="post" th:each="post : ${posts}">
          <div class="d-flex justify-content-between mb-2">
            <div class="d-flex">
              <img th:src="${post.avatarUrl}" class="rounded-circle me-2" width="40" height="40" alt="User">
              <div class="d-flex flex-column align-items-start">
                <h4 th:text="${post.username}" class="mb-1"></h4>
                <small class="text-muted" th:text="${post.timeAgo}"></small>
              </div>
            </div>
            <div class="dropdown">
              <button class="btn btn-link text-dark" type="button" id="postMenu" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bi bi-three-dots"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="postMenu">
                <li><a class="dropdown-item" href="#"><i class="bi bi-pencil me-2"></i>Ch·ªânh s·ª≠a b√†i vi·∫øt</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-trash me-2"></i>Xo√° b√†i vi·∫øt</a></li>
                <li><a class="dropdown-item" href="#"><i class="bi bi-flag me-2"></i>B√°o c√°o b√†i vi·∫øt</a></li>
              </ul>
            </div>
          </div>
          <p style="text-align: left !important;" th:text="${post.content}"></p>
          <div class="post-images">
            <div th:if="${#lists.size(post.imageUrls) == 1}">
              <img th:src="${post.imageUrls[0]}" alt="Post Image">
            </div>
            <div th:if="${#lists.size(post.imageUrls) > 1}" class="image-container">
              <img th:each="imageUrl, iterStat : ${post.imageUrls}"
                   th:if="${iterStat.index < 2}"
                   th:src="${imageUrl}"
                   onclick="openImage(this)"
                   alt="Post Image">
              <div th:if="${#lists.size(post.imageUrls) > 2}"
                   class="more-images"
                   th:text="'+' + (${#lists.size(post.imageUrls)} - 2) + ' ·∫£nh n·ªØa'"
                   onclick="showAllImages(this)">
              </div>
              <div class="hidden-images" style="display: none;">
                <img th:each="imageUrl, iterStat : ${post.imageUrls}"
                     th:if="${iterStat.index >= 2}"
                     th:src="${imageUrl}"
                     onclick="openImage(this)"
                     alt="Post Image">
              </div>
              <div class="collapse-images" style="display: none;" onclick="collapseImages(this)">
                Thu g·ªçn
              </div>
            </div>
          </div>
          <div class="post-actions d-flex gap-2 align-items-center">
            <button class="btn btn-outline-secondary heart-btn" th:attr="data-post-id=${post.postId}"
                    th:classappend="${post.liked} ? 'text-danger' : ''" onclick="toggleLike(this)">
              <i class="bi" th:classappend="${post.liked} ? 'bi-heart-fill' : 'bi-heart'"></i>
              <span class="heart-count" th:text="${post.likeCount}">0</span>
            </button>
            <button class="btn btn-outline-secondary toggle-comments">
              <i class="bi bi-chat"></i>
              <span class="comment-count" th:text="${#lists.size(post.comments)}">0</span>
            </button>
            <button class="btn btn-outline-secondary share-button ms-auto">
              <i class="bi bi-share"></i>
            </button>
          </div>
          <div class="comments-section mt-3" style="display: none;">
            <div class="comment-list">
              <div th:each="comment, iterStat : ${post.comments}"
                   class="comment-item border-bottom py-2"
                   th:classappend="${iterStat.index >= 2} ? 'hidden-comment' : ''">
                <div class="d-flex">
                  <!-- ·∫¢nh ƒë·∫°i di·ªán -->
                  <img th:src="${comment.avatarUrl}" class="rounded-circle me-2" width="20" height="20" alt="User">

                  <div class="flex-grow-1">
                    <div class="d-flex justify-content-between">
                      <h6 class="mb-0" th:text="${comment.username}"></h6>
                      <div class="comment-actions" style="display: none;">
                        <button class="btn btn-sm btn-link text-primary"><i class="bi bi-pencil"></i></button>
                        <button class="btn btn-sm btn-link text-danger"><i class="bi bi-trash"></i></button>
                        <button class="btn btn-sm btn-link text-secondary"><i class="bi bi-flag"></i></button>
                      </div>
                    </div>
                    <p style="text-align: left !important;" class="mb-0" th:text="${comment.content}"></p>
                    <small style="text-align: left !important;" th:text="${comment.timeAgo}" class="text-muted"></small>

                    <!-- Hi·ªÉn th·ªã ·∫£nh trong b√¨nh lu·∫≠n -->
                    <div th:if="${comment.imageUrls != null and !comment.imageUrls.isEmpty()}" class="comment-images mt-2">
                      <img th:each="imageUrl : ${comment.imageUrls}"
                           th:src="${imageUrl}"
                           class="comment-image rounded"
                           onclick="openImage(this)"
                           width="60" height="60"
                           style="cursor: pointer;">
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- N√∫t Hi·ªÉn th·ªã th√™m b√¨nh lu·∫≠n -->
            <div th:if="${#lists.size(post.comments) > 2}" class="show-more-comments text-primary mt-2" onclick="showMoreComments(this)" style="cursor: pointer;">
              Hi·ªÉn th·ªã th√™m b√¨nh lu·∫≠n
            </div>

            <!-- Form b√¨nh lu·∫≠n -->
            <div class="add-comment mt-3">
              <form id="comment-form" action="/forum/comment" method="post" enctype="multipart/form-data">
                <div class="d-flex">
                  <input type="hidden" name="postId" th:value="${post.postId}">
                  <input type="hidden" name="username" th:value="${username}">
                  <!-- ·∫¢nh ƒë·∫°i di·ªán ng∆∞·ªùi d√πng -->
                  <img th:src="${avatarUrl}" class="rounded-circle me-2" width="32" height="32" alt="User">

                  <div class="flex-grow-1">
                    <textarea name="content" class="form-control" placeholder="Vi·∫øt b√¨nh lu·∫≠n..." rows="1"></textarea>
                    <input type="file" name="commentImages" class="form-control mt-2" multiple>
                    <button type="submit" class="btn btn-primary mt-2">B√¨nh lu·∫≠n</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </main>
    <aside class="col-md-3">
      <div class="card">
        <div class="card-header">
          <h2>Ranking</h2>
        </div>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">Username 1 - Score</li>
          <li class="list-group-item">Username 2 - Score</li>
        </ul>
      </div>
    </aside>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/forum.js"></script>
<div id="lightbox" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
  <img id="lightbox-image" class="max-w-full max-h-full object-contain" alt="Enlarged Image">
  <button id="lightbox-close" class="absolute top-4 right-4 text-white text-3xl font-bold cursor-pointer">√ó</button>
</div>
</body>
</html>
